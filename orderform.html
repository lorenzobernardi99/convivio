<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Convivio</title>
  <link rel="stylesheet" href="/css/orderstyle.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Sacramento&display=swap" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:300,400,500,600,700,900&display=swap" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
  <link rel="stylesheet" href="/css/homepage.css">
  <script src="https://code.jquery.com/jquery-3.7.0.min.js" integrity="sha256-2Pmvv0kuTBOenSvLm6bvfBSSHrUJ+3A7x6P5Ebd07/g=" crossorigin="anonymous"></script>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="container-fluid">
        <a class="navbar-brand py-0" href="/"><img src="/img/logo.png" alt="logo"></a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" href="#">ABOUT</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link login-btn" id="googleSignInButton" href="#">LOGIN</a>
                </li>
            </ul>
        </div>
    </div>
</nav>


<div>

  <h1>YOUR EVENT STARTS HERE</h1>
  <div id="multi-step-form-container">
    <!-- Form Steps / Progress Bar -->
    <ul class="form-stepper form-stepper-horizontal text-center mx-auto pl-0">


      <!-- Step 1 -->
      <li class="form-stepper-active text-center form-stepper-list" step="1">
        <a class="mx-2">
                    <span class="form-stepper-circle">
                        <span>1</span>
                    </span>
          <div class="label">Type</div>
        </a>
      </li>


      <!-- Step 2 -->
      <li class="form-stepper-unfinished text-center form-stepper-list" step="2">
        <a class="mx-2">
                    <span class="form-stepper-circle text-muted">
                        <span>2</span>
                    </span>
          <div class="label text-muted">Date and Time</div>
        </a>
      </li>


      <!-- Step 3 -->
      <li class="form-stepper-unfinished text-center form-stepper-list" step="3">
        <a class="mx-2">
                    <span class="form-stepper-circle text-muted">
                        <span>3</span>
                    </span>
          <div class="label text-muted">Place</div>
        </a>
      </li>


      <!-- Step 4 -->
      <li class="form-stepper-unfinished text-center form-stepper-list" step="4">
        <a class="mx-2">
                    <span class="form-stepper-circle text-muted">
                        <span>4</span>
                    </span>
          <div class="label text-muted">Guests</div>
        </a>
      </li>

      <!-- Step 5 -->
      <li class="form-stepper-unfinished text-center form-stepper-list" step="5">
          <a class="mx-2">
                    <span class="form-stepper-circle text-muted">
                        <span>5</span>
                    </span>
              <div class="label text-muted">Format</div>
          </a>
      </li>

      <!-- Step 6 -->
      <li class="form-stepper-unfinished text-center form-stepper-list" step="6">
          <a class="mx-2">
                    <span class="form-stepper-circle text-muted">
                        <span>6</span>
                    </span>
              <div class="label text-muted">Menu</div>
          </a>
      </li>
  
      <!-- Step 10 -->
      <li class="form-stepper-unfinished text-center form-stepper-list" step="10">
          <a class="mx-2">
                    <span class="form-stepper-circle text-muted">
                        <span>7</span>
                    </span>
              <div class="label text-muted">Apetizers</div>
          </a>
      </li>
      <!-- Step 20 -->
      <li class="form-stepper-unfinished text-center form-stepper-list" step="20">
          <a class="mx-2">
                    <span class="form-stepper-circle text-muted">
                        <span>8</span>
                    </span>
              <div class="label text-muted">Main Course</div>
          </a>
      </li>
      <!-- Step 11 -->
      <li class="form-stepper-unfinished text-center form-stepper-list" step="6">
          <a class="mx-2">
                    <span class="form-stepper-circle text-muted">
                        <span>11</span>
                    </span>
              <div class="label text-muted">Payment</div>
          </a>
      </li>
      </ul>


    <!-- Step Wise Form Content -->
    <form id="orderForm" name="orderForm" enctype="multipart/form-data" method="POST" action="order_success.html">


      <!-- Step 1 Content -->
      <section id="step-1" class="form-step">
        <h2 class="font-normal">1. What type of event are you planning?</h2>


        <!-- Step 1 input fields -->
        <div class="mt-3" required>
            <label class="form-control">
                <input type="checkbox" name="wedding" />
                Wedding
            </label>

            <label class="form-control">
                <input type="checkbox" name="corporate" />
                Corporate
            </label>

            <label class="form-control">
                <input type="checkbox" name="social" />
                Social
            </label>

            <label class="form-control">
                <input type="checkbox" name="other" />
                Other
            </label>

        </div>
        <div class="mt-3">
          <button class="button btn-navigate-form-step" type="button" step_number="2">Next</button>
        </div>
      </section>


      <!-- Step 2 Content, default hidden on page load. -->
      <section id="step-2" class="form-step d-none">
        <h2 class="font-normal">2. When is your event?</h2>


        <!-- Step 2 input fields -->
        <div class="mt-3">
            <input type="date" name="date">
            <input type="time" name="time">
        </div>
        <div class="mt-3">
          <button class="button btn-navigate-form-step" type="button" step_number="1">Prev</button>
          <button class="button btn-navigate-form-step" type="button" step_number="3">Next</button>
        </div>
      </section>


      <!-- Step 3 Content, default hidden on page load. -->
      <section id="step-3" class="form-step d-none">
        <h2 class="font-normal">3. Where is your event?</h2>


        <!-- Step 3 input fields -->
        <div class="mt-3">
            <input type="text" name="place">
        </div>
        <div class="mt-3">
          <button class="button btn-navigate-form-step" type="button" step_number="2">Prev</button>
            <button class="button btn-navigate-form-step" type="button" step_number="4">Next</button>
        </div>
      </section>
        <!-- Step 4 Content, default hidden on page load. -->
        <section id="step-4" class="form-step d-none">
            <h2 class="font-normal">4. How many guests do you expect?</h2>


            <!-- Step 4 input fields -->
            <div class="mt-3">
                <input type="text" name="guests">
            </div>
            <div class="mt-3">
                <button class="button btn-navigate-form-step" type="button" step_number="3">Prev</button>
                <button class="button btn-navigate-form-step" type="button" step_number="5">Next</button>
            </div>
        </section>
        <!-- Step 5 Content, default hidden on page load. -->
        <section id="step-5" class="form-step d-none">
            <h2 class="font-normal">5. What format are you envisioning?</h2>

            <!-- Step 5 input fields -->
            <div class="mt-3">
                <label class="form-control">
                    <input type="checkbox" name="buffet" />
                    Buffet
                </label>
                <label class="form-control">
                    <input type="checkbox" name="alacarte" />
                    A La Carte
                </label>
            </div>
            <div class="mt-3">
                <button class="button btn-navigate-form-step" type="button" step_number="4">Prev</button>
                <button class="button btn-navigate-form-step" type="button" step_number="6">Next</button>
            </div>
        </section>

        <section id="step-6" class="form-step d-none">
            <h2 class="font-normal">Start choosing your [format] options:</h2>

            <!-- Step 6 input fields send to step 10: apetizers or step 20 main courses-->
            <div class="mt-3">
                <button class="button btn-navigate-form-step" type="button" step_number="10">Apetizer</button>
                <button class="button btn-navigate-form-step" type="button" step_number="20">Main Course</button>
            </div>
            <div class="mt-3">
                <button class="button btn-navigate-form-step" type="button" step_number="5">Prev</button>
                <button class="button btn-navigate-form-step" type="button" step_number="7">Next</button>
            </div>
        </section>

        <section id="step-10" class="form-step d-none">
            <h2 class="font-normal">Apetizers</h2>

            <div class="mt-3">
                <div id="appetizersSection">
                </div>


            </div>
            <div class="mt-3">
                <button class="button btn-navigate-form-step" type="button" step_number="20">Go to main Courses</button>
                <button class="button submit-btn" type="submit">Send order</button>

            </div>
        </section>

        <section id="step-20" class="form-step d-none">
            <h2 class="font-normal">Main Course</h2>

            <div class="mt-3">

                <div id="mainDishesSection">
                </div>
                <div>


                    <div class="mt-3">
                        <button class="button btn-navigate-form-step" type="button" step_number="10">Go to Apetizers</button>
                        <button class="button submit-btn" type="submit">Send order</button>

                    </div>
        </section>

              <section id="step-11" class="form-step d-none">
            <h2 class="font-normal">Payment</h2>

            <div class="mt-3">
              <div class="container" style="display: flex; justify-content: center; align-items: center; height: 100vh;">
      <div id="paypal-button-container" style="width: min-content; position: absolute; top: 20%;"></div>
    </div>
                <div>


                    <div class="mt-3">
                        <button class="button btn-navigate-form-step" type="button" step_number="10">Check your order</button>
                        <button class="button complete-btn" type="submit">Complete order</button>

                    </div>
        </section>




    </form>
  </div>
</div>



<div class="footer-container">
    <footer class="my-5">
        <div class="container text-center text-md-start">
            <div class="row align-items-center">
                <div class="col-md-4 about-us-section">
                    <h3>ABOUT US</h3>
                    <p>We pride ourselves on creating unique menus to accommodate every special event. <br>
                        Our goal is to always provide the best experience placing the customers at the top of our priority.</p>
                </div>
                <div class="col text-center">
                    <img src="/img/logo_noname.png" alt="logo" class="footer-logo">
                </div>
                <div class="col-md-4 footer-info-section">
                    <div>
                        <h3>OUR LOCATION</h3>
                        <p>15 Main Street, Trento, Italy</p>
                    </div>
                    <div>
                        <h3>CONTACT INFORMATION</h3>
                        <p>Phone: +39 (047) 4567-890<br>Email: contact@convivio.com</p>
                    </div>
                </div>
            </div>
        </div>
    </footer>
</div>




<script>

  /**
   * Define a function to navigate betweens form steps.
   * It accepts one parameter. That is - step number.
   */
  const navigateToFormStep = (stepNumber) => {
    /**
     * Hide all form steps.
     */
    document.querySelectorAll(".form-step").forEach((formStepElement) => {
      formStepElement.classList.add("d-none");
    });
    /**
     * Mark all form steps as unfinished.
     */
    document.querySelectorAll(".form-stepper-list").forEach((formStepHeader) => {
      formStepHeader.classList.add("form-stepper-unfinished");
      formStepHeader.classList.remove("form-stepper-active", "form-stepper-completed");
    });
    /**
     * Show the current form step (as passed to the function).
     */
    document.querySelector("#step-" + stepNumber).classList.remove("d-none");
    /**
     * Select the form step circle (progress bar).
     */
    const formStepCircle = document.querySelector('li[step="' + stepNumber + '"]');
    /**
     * Mark the current form step as active.
     */
    formStepCircle.classList.remove("form-stepper-unfinished", "form-stepper-completed");
    formStepCircle.classList.add("form-stepper-active");
    /**
     * Loop through each form step circles.
     * This loop will continue up to the current step number.
     * Example: If the current step is 3,
     * then the loop will perform operations for step 1 and 2.
     */
    for (let index = 0; index < stepNumber; index++) {
      /**
       * Select the form step circle (progress bar).
       */
      const formStepCircle = document.querySelector('li[step="' + index + '"]');
      /**
       * Check if the element exist. If yes, then proceed.
       */
      if (formStepCircle) {
        /**
         * Mark the form step as completed.
         */
        formStepCircle.classList.remove("form-stepper-unfinished", "form-stepper-active");
        formStepCircle.classList.add("form-stepper-completed");
      }
    }
  };
  /**
   * Select all form navigation buttons, and loop through them.
   */
  document.querySelectorAll(".btn-navigate-form-step").forEach((formNavigationBtn) => {
    /**
     * Add a click event listener to the button.
     */
    formNavigationBtn.addEventListener("click", () => {
      /**
       * Get the value of the step.
       */
      const stepNumber = parseInt(formNavigationBtn.getAttribute("step_number"));
      /**
       * Call the function to navigate to the target form step.
       */
      navigateToFormStep(stepNumber);
    });
  });
</script>
<script src="/js/new-orders.js"></script>
              <script src="https://www.paypal.com/sdk/js?client-id=AReTncnN3aPDxsTEaxDl-NDTVAH8-2jbmx5ohXHBY61S25skKGHwOptQAvOlgnQo7dmULtgRmT8sN84o&components=buttons&currency=EUR"></script>
    <script>

      const FUNDING_SOURCES = [
          paypal.FUNDING.PAYPAL
      ];
      FUNDING_SOURCES.forEach(fundingSource => {

        paypal
          .Buttons({

            fundingSource,

            style: {
              layout: 'vertical',
              shape: 'pill',
              color: (fundingSource == paypal.FUNDING.PAYLATER) ? 'gold' : '',
            },


            createOrder: async (data, actions) => {
              const response = await fetch("/orders", {
                method: "POST",
              });
              const details = await response.json();
              return details.id;
            },
            onApprove: async (data, actions) => {
              const response = await fetch(`/orders/${data.orderID}/capture`, {
                method: "POST",
              });
              const details = await response.json();
              // 3 casi:
              //   (1) errore INSTRUMENT_DECLINED -> call actions.restart()
              //   (2) errori- show errorOther non-recoverable errors -> Show a failure message
              //   (3) transazione correttamente eseguita->mostra conferma

              // possiamo cambiare struttura 'orderData'

              const errorDetail =
                Array.isArray(details.details) && details.details[0];
              if (errorDetail && errorDetail.issue === "INSTRUMENT_DECLINED") {
                return actions.restart(); // Recoverable state, per:
                // https://developer.paypal.com/docs/checkout/integration-features/funding-failure/
              }

              if (errorDetail) {
                let msg = "Scusa, il pagamento non è andato a buon fine";
                if (errorDetail.description)
                  msg += "\n\n" + errorDetail.description;
                if (details.debug_id) msg += " (" + details.debug_id + ")";
                return alert(msg); // mostra errore fallimento
              }

              //capture correttamente eseguita
              console.log(
                "Capture result",
                details,
                JSON.stringify(details, null, 2)
              );
              const transaction = details.purchase_units[0].payments.captures[0];
              window.location.href = "order_success.html";
            },
          })
          .render("#paypal-button-container");
        })
    </script>

</body>
</html>
